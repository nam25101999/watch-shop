{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block title %}Giỏ hàng của bạn{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto p-4">
  <h1 class="text-3xl font-bold mb-6">Giỏ hàng của bạn</h1>

  {% if items %}
    <table class="w-full text-left border-collapse border border-gray-300">
      <thead>
        <tr class="bg-gray-100">
          <th class="border border-gray-300 p-2">Sản phẩm</th>
          <th class="border border-gray-300 p-2">Giá</th>
          <th class="border border-gray-300 p-2">Số lượng</th>
          <th class="border border-gray-300 p-2">Thành tiền</th>
          <th class="border border-gray-300 p-2">Thao tác</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
        <tr>
          <td class="border border-gray-300 p-2 flex items-center gap-4">
            {% if item.product.image %}
              <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="w-16 h-16 object-cover rounded" />
            {% else %}
              <img src="{% static 'images/no-image.png' %}" alt="No image" class="w-16 h-16 object-cover rounded" />
            {% endif %}
            <span>{{ item.product.name }}</span>
          </td>
          <td class="border border-gray-300 p-2">{{ item.product.price }}₫</td>
          <td class="border border-gray-300 p-2">
            <form method="post" action="{% url 'cart:update_cart_item' item.id %}">
              {% csrf_token %}
              <input type="number" name="quantity" value="{{ item.quantity }}" min="0" class="w-16 border rounded px-1" />
              <button type="submit" class="ml-2 bg-yellow-400 hover:bg-yellow-500 text-white px-2 py-1 rounded">Cập nhật</button>
            </form>
          </td>
          <td class="border border-gray-300 p-2">{{ item.product.price|floatformat:0|intcomma }}₫</td>
          <td class="border border-gray-300 p-2">
            <form method="post" action="{% url 'cart:remove_cart_item' item.id %}">
              {% csrf_token %}
              <button type="submit" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded">Xóa</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <td colspan="3" class="text-right font-bold p-2">Tổng cộng:</td>
          <td colspan="2" class="font-bold p-2">{{ total|floatformat:0|intcomma }}₫</td>
        </tr>
      </tfoot>
    </table>

    <div class="mt-6">
      <a href="{% url 'cart:checkout' %}" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded font-semibold">Thanh toán</a>
      <a href="{% url 'products:product_list' %}" class="ml-4 underline">Tiếp tục mua sắm</a>
    </div>
  {% else %}
    <p>Giỏ hàng của bạn đang trống.</p>
    <a href="{% url 'products:product_list' %}" class="underline text-blue-600">Quay lại mua sắm</a>
  {% endif %}
  
</div>

{% endblock %}
